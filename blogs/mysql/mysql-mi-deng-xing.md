# 【mysql】幂等性
幂等性是对于后端接口而言的，指的是系统A对系统B的后端接口进行多次调用所产生的结果和调用一次所产生的结果是一致的。

幂等性问题示例：新增书籍的时候，如果用户在前端界面点了多次新增按钮，那么就会将同一本书籍存入数据库多次，就会导致数据库中存在多本相同的书籍，这就是幂等性问题。对于这类问题，可能会采取以下解决方法：
1. 前端防抖处理，利用lodash的debounce函数，使得用户在某个时间段内（例如1秒内）的多次点击只会触发一次ajax函数调用。
2. 后端在insert之前，先进行select，由此来判断书籍是否已存在。

以上解决方法都是**不正确**的，因为在web应用中是存在并发问题的，在并发情况下，有可能有多个用户在同一时刻对同一本书籍进行新增。

**正确**的方法是，在书籍表中添加一个**唯一约束**字段（该字段可以是书籍的条形码），由数据库来帮我们进行唯一校验，当书籍已存在的时候，数据库将会抛出异常DuplicateKeyException，然后我们捕获这个异常，并给前端返回友好提示。

以上所谓的**正确**的方法有时候也不正确，比如：假设书籍表中同一类型的书籍编码不能重复，但不同类型的书籍的编码可以重复，这个时候就不能将书籍编码在数据库中设置唯一约束，而是要将书籍的类型和编码一起设置为**联合唯一约束**。

**乐观锁和悲观锁适用于：依赖读取的数据作为基础条件的更新场景**  
**幂等性适用于：有唯一性业务需求的新增场景**