# 【搜索引擎-Elasticsearch】基本概念
Elasticsearch （简称 ES ）是一个分布式的文档型数据库。 ES 以 JSON 文档的形式存储复杂的结构化数据。ES 使用`倒排索引`的数据结构，支持非常快速的全文搜索，当文档数据被存储到 ES 后，将会被自动添加索引。其搜索结果能够在 1 秒之内出来，注意这里的 1 秒并不是指的查询耗时，而是说 1 秒之内数据能够完成同步并且能够被查询。

* 正排索引：以文档对象的唯一标识作为索引，以文档内容作为记录。
* 倒排索引：以文档内容的单词作为索引，以包含该单词的文档ID作为记录。

## 基本概念
* 索引：相当于 MySQL 的 table 。是一组文档的集合。
* 文档：相当于 MySQL 的 row 。其中的字段形式为 key-value 。
* 集群和节点：一个集群中有多个节点，文档数据会存储在集群中的每个节点并且可以通过任意一个节点来访问。
* 分片和副本：在创建索引时可以定义分片的数量， ES 会把这个索引中的数据拆分到这些分片中，每个分片本身就是一个独立的索引，每个分片可以存储在集群的任意节点。分片提高了水平扩展能力，但如果某个分片出现了故障，那么这部分数据就会不可用。所以在创建索引时可以定义副本的数量，这里的副本指的是分片的副本，可以实现分片的高可用，开启副本后，每个索引将有主分片和副本分片，需要注意的是主分片和副本分片不会被分配到相同的节点上。在创建索引之后，也可以在任何时候动态的改变副本的数量，但是不能够改变分片数量。默认情况下， ES 中的每个索引分配了 5 个主分片和 1 个副本。

## 映射
映射可以定义文档及其包含的字段的数据结构和索引方式。包括显式映射和动态映射，默认为动态映射。

可以在创建或修改索引的时候通过`dynamic`字段值来配置映射类型，可选项如下：
* true （默认） ：新的字段将会自动添加到映射中。
* runtime ：新的字段将会以运行时字段的形式自动添加到映射中，运行时字段不会被添加索引，在查询的时候会放到`_source`字段中。
* false ：新的字段将会被忽略，不会添加到映射中，但在查询的时候还是会放到`_source`字段中。
* strict ：如果发现有新的字段，请求将会报错。新的字段必须显式的添加到映射中。

默认为动态映射类型，要想改为显式映射类型可以直接将`dynamic`设置为`strict`。

### 显式映射
可以通过预定定义文档中的字段来获得以下能力：
* 能够区分全文字符串字段和精确值字符串字段。
* 能够执行特定语言的文本分析，即分词。
* 能够优化字段以实现部分匹配。
* 能够使用自定义日期格式。
* 能够使用地理点和地理形状等无法自动检测的数据类型。

### 动态映射
不需要预先定义文档中的字段， ES 会自动创建映射，并且添加文档中不存在的新字段到映射中，包括该字段的数据类型。